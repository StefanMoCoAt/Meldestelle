# ===================================================================
# Docker Compose - Application Services
# Generated from docker/versions.toml
# Environment: development
# Generated: 2025-11-11 23:07:01 UTC
# ===================================================================

services:
  ping-service:
    build:
      context: .
      dockerfile: dockerfiles/services/ping-service/Dockerfile
      args:
        # Global build arguments (build-time only)
        GRADLE_VERSION: 9.1.0
        JAVA_VERSION: 21
        BUILD_DATE: ${BUILD_DATE:-unknown}
        VERSION: 1.0.0
    container_name: meldestelle-ping-service
    env_file:
      - config/env/.env
      # Optional service-specific overrides (only if file exists)
      - config/env/services/ping-service.env
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-docker}
      SERVER_PORT: ${PING_SERVICE_PORT:-8082}
      DEBUG: ${DEBUG:-true}
      LOGGING_LEVEL_ROOT: ${LOGGING_LEVEL_ROOT:-DEBUG}
      JVM_DEBUG_PORT: 5005
    ports:
      - "${PING_SERVICE_PORT:-8082}:8082"
      - "5005:5005"  # Debug-Port
    networks:
      - meldestelle-network
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8082/actuator/health/readiness"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 40s
    restart: unless-stopped

  api-gateway:
    build:
      context: .
      dockerfile: dockerfiles/infrastructure/gateway/Dockerfile
      args:
        # Global build arguments (build-time only)
        GRADLE_VERSION: 9.1.0
        JAVA_VERSION: 21
        BUILD_DATE: ${BUILD_DATE:-unknown}
        VERSION: 1.0.0
    container_name: meldestelle-api-gateway
    env_file:
      - config/env/.env
      # Optional infrastructure-specific overrides (only if file exists)
      - config/env/infrastructure/api-gateway.env
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-docker}
      SERVER_PORT: ${GATEWAY_PORT:-8081}
      DEBUG: ${DEBUG:-true}
      LOGGING_LEVEL_ROOT: ${LOGGING_LEVEL_ROOT:-DEBUG}
      JVM_DEBUG_PORT: 5005
    ports:
      - "${GATEWAY_PORT:-8081}:8081"
      - "5005:5005"  # Debug-Port
    networks:
      - meldestelle-network
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8081/actuator/health/readiness"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 40s
    restart: unless-stopped

# ===================================================================
# Networks (shared network from main compose file)
# ===================================================================
networks:
  meldestelle-network:
    driver: bridge
