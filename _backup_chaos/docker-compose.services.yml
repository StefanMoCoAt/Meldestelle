# ===================================================================
# Docker Compose - Application Services
# Generated from docker/versions.toml
# Environment: development
# Generated: 2025-11-18 19:43:46 UTC
# ===================================================================

services:
  profiles: ["app", "backend"]
  ping-service:
    build:
      context: ..
      dockerfile: ../dockerfiles/services/ping-service/Dockerfile
      args:
        # Global build arguments (centralized DOCKER_* variables)
        GRADLE_VERSION: ${DOCKER_GRADLE_VERSION}
        JAVA_VERSION: ${DOCKER_JAVA_VERSION}
        BUILD_DATE: ${BUILD_DATE}
        VERSION: ${DOCKER_APP_VERSION}
        # Service-specific arguments (centralized DOCKER_* variables)
        SPRING_PROFILES_ACTIVE: ${DOCKER_SPRING_PROFILES_DOCKER}
    container_name: meldestelle-ping-service
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}
      SERVER_PORT: ${PING_SERVICE_PORT:-8082}
      DEBUG: ${DEBUG:-true}
      LOGGING_LEVEL_ROOT: ${LOGGING_LEVEL_ROOT:-DEBUG}
      JVM_DEBUG_PORT: 5005
    ports:
      - "${PING_SERVICE_PORT:-8082}:8082"
      - "5005:5005"  # Debug-Port
    networks:
      - meldestelle-network
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8082/actuator/health/readiness"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 40s
    restart: unless-stopped

  api-gateway:
    profiles: ["infra", "gateway"]
    build:
      context: ..
      dockerfile: ../dockerfiles/infrastructure/gateway/Dockerfile
      args:
        # Global build arguments (centralized DOCKER_* variables)
        GRADLE_VERSION: ${DOCKER_GRADLE_VERSION}
        JAVA_VERSION: ${DOCKER_JAVA_VERSION}
        BUILD_DATE: ${BUILD_DATE}
        VERSION: ${DOCKER_APP_VERSION}
        # Infrastructure-specific arguments (centralized DOCKER_* variables)
        SPRING_PROFILES_ACTIVE: ${DOCKER_SPRING_PROFILES_DEFAULT}
    container_name: meldestelle-api-gateway
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}
      SERVER_PORT: ${API_GATEWAY_PORT:-8081}
      DEBUG: ${DEBUG:-true}
      LOGGING_LEVEL_ROOT: ${LOGGING_LEVEL_ROOT:-DEBUG}
      JVM_DEBUG_PORT: 5005
    ports:
      - "${API_GATEWAY_PORT:-8081}:8081"
      - "5005:5005"  # Debug-Port
    networks:
      - meldestelle-network
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8081/actuator/health/readiness"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 40s
    restart: unless-stopped

# ===================================================================
# Networks (shared network from main compose file)
# ===================================================================
networks:
  meldestelle-network:
    driver: bridge
